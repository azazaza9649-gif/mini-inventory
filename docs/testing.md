# ЛР5 — Тестування програмного забезпечення

## Покриття тестами

У проєкті реалізовано комплексне тестування модуля роботи з категоріями та предметами:

- **Unit-тести**: перевіряють бізнес-правила сервісного шару (`CategoryService`, `ItemService`): валідація вхідних даних, помилки (400/404/409), граничні випадки, коректність викликів репозиторію.
- **E2E-тести**: перевіряють повний HTTP-сценарій через API (створення категорії, створення предмета, перевірка заборони видалення категорії з предметами, фільтрація предметів за `categoryId`).

## Інтеграційний аспект

Для інтеграційного рівня використовується реальна робота з БД через Prisma:

- генерація клієнта Prisma;
- застосування міграцій (deploy);
- виконання тестів, які працюють поверх реальних запитів/операцій.

## Мутаційне тестування (Stryker)

Для оцінки якості тестів проведено мутаційне тестування через Stryker.

### Загальні результати

- Знайдено файлів для мутацій: **2**
- Кількість мутантів: **72**
- Виконано тестів у dry-run: **19**
- Підсумок по мутантам:
  - **killed:** 69
  - **survived:** 3
  - **timeout:** 0
  - **no coverage:** 0
  - **errors:** 0
- **Mutation score:** **95.83%** (covered: 95.83%)

### Результати по файлах

| Файл                               | Mutation score | Killed | Survived |
| ---------------------------------- | -------------: | -----: | -------: |
| `src/services/category.service.ts` |         94.74% |     36 |        2 |
| `src/services/item.service.ts`     |         97.06% |     33 |        1 |
| **Усього**                         |     **95.83%** | **69** |    **3** |

### Вижили (survived) мутанти та що покращити

1. **`category.service.ts` — обробка помилок Prisma**

- Мутанти пов’язані зі спрощенням/зміною умов перевірки помилки на наявність поля `code`.
- Рекомендація: додати окремий unit-тест, який:
  - передає в репозиторій помилку-об’єкт без `code` (або з неочікуваною структурою);
  - перевіряє, що сервіс не помилково обробляє її як Prisma-помилку типу `P2002`.

2. **`item.service.ts` — граничне значення `quantity`**

- Мутант змінив умову `quantity < 0` на `quantity <= 0`, тобто тестами не відловлено різницю між дозволеним `0` і забороненим `0`.
- Рекомендація: додати тест-кейс, який явно перевіряє, що `quantity = 0` **допускається** (або **забороняється**, якщо це бізнес-вимога), щоб зафіксувати правило.

## Висновок

Набір unit та e2e тестів ефективно покриває основну бізнес-логіку модуля: показник **mutation score 95.83%** демонструє, що більшість навмисних змін у коді виявляються тестами. Для підвищення якості тестування варто додати кілька прицільних тестів на:

- неочікувані структури помилок при обробці винятків;
- граничні значення `quantity` (зокрема `0`).
